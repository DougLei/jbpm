<?xml version="1.0" encoding="UTF-8"?>
<mapping-configuration>
	<sql namespace="ProcessDefinition">
		
		<!-- 保存时查询流程定义 -->
		<content name="query4Save" type="select">
			select id, subversion, signature, state from bpm_re_procdef where code = #{code} and version = #{version} 
			<if test="tenantId != null and tenantId != ''">
				and tenant_id = #{tenantId}
			</if>
			order by subversion desc
		</content>
		
		<!-- 启动流程时查询流程定义 -->
		<content name="query4Start" type="select">
			select id, name, state from bpm_re_procdef 
			
			<switch>
				<if test="startMode == 1">
					where id = #{processDefinitionId, dataType=number} 
				</if>
				<if test="startMode == 2">
					where code = #{code} and version in (
						select version from bpm_re_procdef  where id in (select max(id) from bpm_re_procdef where code = #{code} and subversion=0
						<if test="tenantId != null and tenantId != ''">
							and tenant_id = #{tenantId} 
						</if>
						)
					)
					<if test="tenantId != null and tenantId != ''">
						and tenant_id = #{tenantId} 
					</if>
					order by subversion desc 
				</if>
				<if test="startMode == 3">
					where code = #{code} and version = #{version} 
					<if test="tenantId != null and tenantId != ''">
						and tenant_id = #{tenantId} 
					</if>
					order by subversion desc
				</if>
			</switch>
		</content>
		
	</sql>
</mapping-configuration>