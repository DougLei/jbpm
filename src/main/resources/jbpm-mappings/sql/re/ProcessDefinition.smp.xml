<?xml version="1.0" encoding="UTF-8"?>
<mapping-configuration>
	<sql namespace="ProcessDefinition">
		
		<!-- 保存时查询流程定义 -->
		<content name="query4Save" type="select">
			select id, subversion, signature, state from bpm_re_procdef where code = #{code} and version = #{version} 
			<if test="tenantId != null and tenantId != ''">
				and tenant_id = #{tenantId}
			</if>
			order by subversion desc
		</content>
		
		<!-- 启动流程时查询流程定义 -->
		<content name="query4Start" type="select">
			select id, name, state from bpm_re_procdef 
			
			<switch>
				<if test="mode.name() == 'BY_PROCESS_DEFINITION_ID'">
					where id = #{processDefinitionId, dataType=number} 
				</if>
				<if test="mode.name() == 'BY_PROCESS_DEFINITION_CODE_VERSION'">
					where code = #{code} and version = #{version} 
					<if test="tenantId != null and tenantId != ''">
						and tenant_id = #{tenantId} 
					</if>
					order by subversion desc
				</if>
			</switch>
		</content>
		
	</sql>
</mapping-configuration>